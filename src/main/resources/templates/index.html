<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
  <meta charset="UTF-8">
  <title>ì§„ì •ì„œ ì±—ë´‡</title>
  <link rel="stylesheet" th:href="@{/css/header.css}">
  <link rel="stylesheet" th:href="@{/css/index.css}">
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>
  <header th:replace="~{fragment/header :: header}"></header>
  <div class="split-layout">
    <div id="left-frame" class="left-frame full">
      <div th:replace="~{fragment/left :: left}"></div>
    </div>
  </div>

  <div id="right-frame" class="right-frame">
    <div th:replace="~{fragment/right :: right}"></div>
  </div>
  <input type="hidden" id="templateAssistantId" value="{{ template_assistant_id }}">
  <input type="hidden" id="feedbackAssistantId" value="{{ feedback_assistant_id }}">
  <input type="hidden" id="miniAssistantId" value="{{ mini_assistant_id }}">



  <script>
    // ==============================================================================
    // 1. ê¸°ë³¸ ë ˆì´ì•„ì›ƒ / í˜ì´ì§€ ì „í™˜
    // ==============================================================================
    // -------------------------------
    // 1-1. í˜ì´ì§€ ë ˆì´ì•„ì›ƒ (left/right) í† ê¸€
    // -------------------------------
    let chatVisible = false;

    function openChat() {
      if (!chatVisible) toggleChat();
    }

    function toggleChat() {
      const left = document.getElementById("left-frame");
      const right = document.getElementById("right-frame");

      const isChatOpen = right.classList.contains("show");

      if (isChatOpen) {
        left.classList.remove("half");
        left.classList.add("full");
        right.classList.remove("show");
      } else {
        left.classList.remove("full");
        left.classList.add("half");
        right.classList.add("show");
      }
    }

    // -------------------------------
    // 1-2. ì‘ì„± ë‹¨ê³„(step) ì´ë™
    // -------------------------------
    function goToStep(step) {
      const complaintTypeSelect = document.getElementById('complaintTypeSelect');
      const complaintType = complaintTypeSelect ? complaintTypeSelect.value : "";

      if (!complaintType) {
        alert("ë¨¼ì € ì§„ì • ì¢…ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        return;
      }

      const etcComplaintTypes = ["ë¶€ë‹¹í•´ê³ ", "ì§ì¥ë‚´ê´´ë¡­í˜", "ê·¼ë¡œê³„ì•½ìœ„ë°˜", "ê³ ìš©ì°¨ë³„"];

      if (step === 2) {
        // ê¸°ë³¸ì§„ì •ì„œë¡œ ê°€ë ¤ëŠ” ê²½ìš°
        if (etcComplaintTypes.includes(complaintType)) {
          alert("ì„ íƒí•œ ì§„ì • ìœ í˜•ì€ ê¸°ë³¸ ì§„ì •ì„œë¡œ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nê¸°íƒ€ ì§„ì •ì„œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.");
          return;
        }
      }

      if (step === 3) {
        // ê¸°íƒ€ì§„ì •ì„œë¡œ ê°€ë ¤ëŠ” ê²½ìš°
        if (!etcComplaintTypes.includes(complaintType)) {
          alert("ì„ íƒí•œ ì§„ì • ìœ í˜•ì€ ê¸°íƒ€ ì§„ì •ì„œë¡œ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nê¸°ë³¸ ì§„ì •ì„œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.");
          return;
        }
      }

      // ì •ìƒì  ë‹¨ê³„ ì´ë™í•˜ê¸°
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById('step' + step).classList.add('active');
    }
    // -------------------------------
    // 1-3.í¼ ì œì¶œ í•¸ë“¤ë§
    // -------------------------------
    function handleSubmit(event) {
      event.preventDefault();
      alert("ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.");
      window.location.href = "/";

    }

    // ==============================================================================
    // 2. ì§„ì •ì„œ ì¶”ì²œ ë¬¸êµ¬ í‘œì‹œ
    // ==============================================================================
    // -------------------------------
    // 2-1. ì¶”ì²œ ë¬¸êµ¬ ë³´ì—¬ì£¼ê¸°
    // -------------------------------
    function showSuggestion(targetTextareaId, messageText) {
      const suggestionId = targetTextareaId + "Suggestion";
      const box = document.getElementById(suggestionId);
      //ë©”ì‹œì§€ê°€ ì—†ëŠ” ê²½ìš°
      if (!messageText) {
        box.innerHTML = `
      <div class="suggestion-empty">
        âœ… í•´ë‹¹ í•­ëª©ì€ ì‚¬ìš©ìê°€ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”
      </div>
    `;
        return;
      }
      //ë©”ì‹œì§€ê°€ ìˆëŠ” ê²½ìš°
      box.innerHTML = `
    <div class="suggestion-box">
      <strong>ìƒì„±ëœ ë©”ì‹œì§€ë¥¼ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</strong><br><br>
      ${messageText.replace(/\n/g, "<br>")}
      <br>
      <button onclick="applySuggestion('${targetTextareaId}', \`${messageText}\`)">ìˆ˜ì •</button>
      <button onclick="removeSuggestion('${suggestionId}')">ì‚­ì œ</button>
    </div>
  `;
    }

    // 2-2. ì¶”ì²œ ë¬¸êµ¬ ì ìš©í•˜ê¸°
    function applySuggestion(textareaId, messageText) {
      const textarea = document.getElementById(textareaId);
      textarea.value = messageText;
      const suggestionBoxId = textareaId + "Suggestion";
      removeSuggestion(suggestionBoxId);
    }

    // 2-3. ì¶”ì²œ ë¬¸êµ¬ ì‚­ì œí•˜ê¸°
    function removeSuggestion(suggestionId) {
      document.getElementById(suggestionId).innerHTML = "";
    }

    // ==============================================================================
    // 3. ì±—ë´‡ ëŒ€í™” ê¸°ëŠ¥
    // ==============================================================================
    // -------------------------------
    // 3-1. ì±—ë´‡ ë©”ì‹œì§€ ë Œë”ë§
    // -------------------------------
    let chatBox;
    let input;
    let sendBtn;

    const THREAD_ID = "thread_EfihZmqlmi5Ug8whs3Ey1yqi";  // ëŒ€í™” ìŠ¤ë ˆë“œ ID

    function renderMessage(sender, content, isLoading = false) {
      const role = sender === "bot" ? "bot" : "user";
      const name = sender === "bot" ? "ì±—ë´‡" : "ì‚¬ìš©ì";
      const avatar = sender === "bot" ? "ğŸ¤–" : "ğŸ™‚";
      const bubble = isLoading ? "ë¡œë”© ì¤‘..." : content;

      if (sender === "user") {
        return `
        <div class="message ${role}${isLoading ? ' loading' : ''}">
          <div class="bubble">${bubble}</div>
          <div class="name">${name}</div>
          <div class="avatar">${avatar}</div>
        </div>
      `;
      } else {
        return `
        <div class="message ${role}${isLoading ? ' loading' : ''}">
          <div class="avatar">${avatar}</div>
          <div class="name">${name}</div>
          <div class="bubble">${bubble}</div>         
        </div>
      `;
      }
    }
    // -------------------------------
    // 3-2. ì±„íŒ…ì°½ ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ ì´ë™
    // -------------------------------
    function scrollToBottom() {
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // -------------------------------
    // 3-3. ì±—ë´‡ ì„œë²„ë¡œ ë©”ì‹œì§€ ì „ì†¡
    // -------------------------------


    async function sendMessage() {
      //1. ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
      const message = input.value.trim();
      if (!message) return;
      //2. ì‚¬ìš©ì ë©”ì‹œì§€ + "ë¡œë”©ì¤‘..." í™”ë©´ì— ì¶œë ¥
      chatBox.innerHTML += renderMessage("user", message);
      chatBox.innerHTML += renderMessage("bot", "", true); // ë¡œë”© í‘œì‹œ
      scrollToBottom();
      //3. ì…ë ¥ì°½ ë¹„ìš°ê¸°
      input.value = "";
      //4. ì„œë²„ë¡œ POST ìš”ì²­ ë³´ë‚´ê¸°
      try {
        const res = await fetch("http://localhost:8000/ask_mini", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            thread_id: THREAD_ID,
            message: message,
          })
        });
        //5. ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
        const data = await res.json();
        const botResponse = convertToHtmlFromAiText(data.answer);
        //6. "ë¡œë”©ì¤‘..." ëŒ€ì‹  ì§„ì§œ ì±—ë´‡ ë‹µë³€ ì¶œë ¥
        const loadingEl = document.querySelector(".message.bot.loading");
        if (loadingEl) {
          loadingEl.outerHTML = renderMessage("bot", botResponse);
          scrollToBottom();
        }
        //7. ì‹¤íŒ¨í•œ ê²½ìš°
      } catch (error) {
        console.error("ì„œë²„ í˜¸ì¶œ ì‹¤íŒ¨:", error);
        const loadingEl = document.querySelector(".message.bot.loading");
        if (loadingEl) {
          loadingEl.outerHTML = renderMessage("bot", "ì±—ë´‡ ì‘ë‹µì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          scrollToBottom();
        }
      }
    }

    // OpenAI ë‹µë³€ì„ HTML í¬ë§·ìœ¼ë¡œ ë³€í™˜
    function convertToHtmlFromAiText(rawResponse) {
      const formattedResponse = rawResponse
      
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/---/g, '<hr style="border: 1px solid #e5e7eb; margin: 1rem 0;">')
        .replace(/^### (.*)$/gm, '<h3>$1</h3>') // H3
        .replace(/^## (.*)$/gm, '<h2>$1</h2>') // H2
        .replace(/^# (.*)$/gm, '<h1>$1</h1>') // H1
        .replace(
          /(https?:\/\/[^\s\)<]+)/g,
          '<a href="$1" target="_blank" style="color:#2563eb; text-decoration:underline;">$1</a>'
        )
        .replace(/\n/g, "<br>");

      return formattedResponse;
    }
    // âœ… ê³¼ê±° ëŒ€í™” ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadPreviousChat() {
      try {
        const response = await fetch(`http://localhost:8087/get_previous_chat?thread_id=${THREAD_ID}`, {
          method: "GET",
          headers: { "Content-Type": "application/json" },
        });
        const data = await response.json();

        data.forEach(chat => {
          const sender = chat.chatter === "bot" ? "bot" : "user";
          const content = chat.chatter === "bot"
            ? convertToHtmlFromAiText(chat.chat_content)
            : chat.chat_content;

          chatBox.innerHTML += renderMessage(sender, content);
        });

        scrollToBottom();
      } catch (error) {
        console.error("Error loading previous chat:", error);
      }
    }
    // âœ… í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œë˜ë©´ ì‹¤í–‰
    window.addEventListener("DOMContentLoaded", () => {
      chatBox = document.getElementById("chat-messages");
      input = document.getElementById("user-input");
      sendBtn = document.getElementById("send-btn");

      sendBtn.addEventListener("click", sendMessage);
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          sendMessage();
        }
      });

      loadPreviousChat();
    });
    //==============================================================================
    // 4. ì§„ì •ì„œ ìë™ ìƒì„± (ì±—ë´‡ í…œí”Œë¦¿)
    //==============================================================================
    // -------------------------------
    // 4-1. ì„œë²„ì— í…œí”Œë¦¿ ìš”ì²­í•˜ê¸°
    // -------------------------------
    async function requestTemplateMessage(extraFields) {
      if (!extraFields) {
        alert("ì…ë ¥ê°’ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”.");
        return;
      }
      let loadingAlert;

      try {
        const complaintTypeSelect = document.getElementById('complaintTypeSelect');
        const complaintType = complaintTypeSelect ? complaintTypeSelect.value : "";

        // ê¸°íƒ€ ì§„ì •ì„œ ì¢…ë¥˜ëŠ” step3ìœ¼ë¡œ ê°•ì œ ì´ë™
        const etcComplaintTypes = ["ë¶€ë‹¹í•´ê³ ", "ì§ì¥ë‚´ê´´ë¡­í˜", "ê·¼ë¡œê³„ì•½ìœ„ë°˜", "ê³ ìš©ì°¨ë³„"];
        if (etcComplaintTypes.includes(complaintType)) {
          goToStep(3);
        }

        // 3ì´ˆ ì´ìƒ ê±¸ë¦¬ë©´ ë¡œë”© ì•ˆë‚´
        const loadingAlert = setTimeout(() => {
          alert("ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
        }, 3000);

        // âœ… 2. ì„œë²„ ìš”ì²­ ë³´ë‚´ê¸°
        const res = await fetch("http://localhost:8000/ask_mini", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: `ë‹¤ìŒ ì…ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì§„ì •ì„œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”:\n${JSON.stringify(extraFields)}`,
            thread_id: THREAD_ID
          })
        });

        // âœ… 3. ì‘ë‹µ ì˜¤ë©´ ê¸°ë‹¤ë¦¬ë˜ ì•Œë¦¼ ì·¨ì†Œ
        clearTimeout(loadingAlert);
        const data = await res.json();
        const templateContent = data.answer;

        applyComplaintTemplate(templateContent, complaintType);

      } catch (error) {
        if (loadingAlert) clearTimeout(loadingAlert);
        alert("í…œí”Œë¦¿ ìš”ì²­ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        console.error(error);
      }
    }

    // ===============================
    // 4-2. ì„œë²„ ì‘ë‹µ ì ìš©í•˜ê¸°
    // ===============================   
    function applyComplaintTemplate(content, complaintType) {
      const extractedContent = extractRealComplaintContent(content);

      // í˜„ì¬ ì–´ëŠ ë‹¨ê³„ì¸ì§€ (2ë‹¨ê³„ or 3ë‹¨ê³„) íŒë‹¨
      const step2Visible = document.getElementById("step2")?.classList.contains("active");
      const step3Visible = document.getElementById("step3")?.classList.contains("active");
      // ê¸°ì¡´ ì¶”ì²œ ë¬¸êµ¬ ëª¨ë‘ ì´ˆê¸°í™”
      ["workDetailSuggestion", "claimDetailSuggestion", "contentSuggestion"].forEach(id => removeSuggestion(id)); // âœ¨ contentSuggestionë„ ê°™ì´ ì´ˆê¸°í™”

      const etcComplaintTypes = ["ë¶€ë‹¹í•´ê³ ", "ì§ì¥ë‚´ê´´ë¡­í˜", "ê·¼ë¡œê³„ì•½ìœ„ë°˜", "ê³ ìš©ì°¨ë³„"];

      if (step2Visible) {
        // ê¸°ë³¸ ì§„ì •ì„œ (ì„ê¸ˆì²´ë¶ˆ)ì¸ ê²½ìš°
        if (complaintType === "ì„ê¸ˆì²´ë¶ˆ") {
          showSuggestion("claimDetail", extractedContent);
          // workDetailì€ ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥ (ì„œë²„ content ë„£ì§€ ì•ŠìŒ)
        }
      } else if (step3Visible) {
        // ê¸°íƒ€ ì§„ì •ì„œ
        if (etcComplaintTypes.includes(complaintType)) {
          showSuggestion("content", extractedContent);
        }
      } else {
        alert("âš ï¸ í˜„ì¬ ì§„ì •ì„œ ì‘ì„± ë‹¨ê³„(step)ë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      }
    }
    function extractRealComplaintContent(fullText) {
      let extracted = "";

      // **ì§„ì • ë‚´ìš©** ë¶€í„° ì‹œì‘
      const startIndex = fullText.indexOf('**ì§„ì • ë‚´ìš©**');
      if (startIndex !== -1) {
        extracted = fullText.substring(startIndex + '**ì§„ì • ë‚´ìš©**'.length).trim();
      } else {
        extracted = fullText; // fallback
      }

      // **ì‹ ì²­ì ì„œëª…:** ê¹Œì§€ë§Œ ìë¥´ê¸°
      const endIndex = extracted.indexOf('**ì‹ ì²­ì ì„œëª…:**');
      if (endIndex !== -1) {
        extracted = extracted.substring(0, endIndex).trim();
      }
      extracted = extracted.replace(/\*\*(.*?)\*\*/g, '$1'); // **í…ìŠ¤íŠ¸** => í…ìŠ¤íŠ¸
      extracted = extracted.replace(/\*(.*?)\*/g, '$1');     // *í…ìŠ¤íŠ¸* => í…ìŠ¤íŠ¸

      return extracted;
    }
    //  ==============================================================================
    // 5. ì…ë ¥ê°’ ê´€ë ¨
    // ==============================================================================
    // -------------------------------
    // 5-1. ì…ë ¥ê°’ ìˆ˜ì§‘í•˜ê¸° 
    // -------------------------------
    function collectExtraFields() {
      const inputs = document.querySelectorAll("input, select, textarea");
      const extraFields = {};
      inputs.forEach(input => {
        const name = input.name;
        if (!name) return;
        if ((input.type === "radio" || input.type === "checkbox") && input.checked) {
          extraFields[name] = input.value;
        } else if (input.type !== "radio" && input.type !== "checkbox") {
          extraFields[name] = input.value.trim();
        }
      });
      return extraFields;
    }

    // ===============================
    // 5-2. ì…ë ¥ê°’ í™•ì¸ í›„ ë‹¤ìŒ ë‹¨ê³„ ì´ë™ (step1 ì™„ë£Œ ì‹œ)
    // ===============================
    function goNextFromStep1() {
      const complaintTypeSelect = document.getElementById('complaintTypeSelect');
      const complaintType = complaintTypeSelect ? complaintTypeSelect.value : "";

      if (!complaintType) {
        alert("ì§„ì • ì¢…ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        return;
      }
      const step1 = document.getElementById('step1');
      const requiredInputs = step1.querySelectorAll('[required]');
      let missingFields = [];

      requiredInputs.forEach(input => {
        if (input.type === "radio" || input.type === "checkbox") {
          const name = input.name;
          const checked = step1.querySelectorAll(`input[name="${name}"]:checked`).length > 0;
          if (!checked) {
            missingFields.push(getLabelText(input));
          }
        } else {
          if (input.value.trim() === "") {
            missingFields.push(getLabelText(input));
          }
        }
      });

      if (missingFields.length > 0) {
        alert(`ë‹¤ìŒ í•­ëª©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”:\n- ${missingFields.join("\n- ")}`);
        return;
      }

      const etcComplaintTypes = ["ë¶€ë‹¹í•´ê³ ", "ì§ì¥ë‚´ê´´ë¡­í˜", "ê·¼ë¡œê³„ì•½ìœ„ë°˜", "ê³ ìš©ì°¨ë³„"];

      if (complaintType === "ì„ê¸ˆì²´ë¶ˆ") {
        goToStep(2);  // ê¸°ë³¸ì§„ì •ì„œë¡œ ì´ë™
      } else if (etcComplaintTypes.includes(complaintType)) {
        goToStep(3);  // ê¸°íƒ€ì§„ì •ì„œë¡œ ì´ë™
      } else {
        alert("ì„ íƒí•œ ì§„ì • ìœ í˜•ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
      }

    }

    // ===============================
    // 5-3. ì…ë ¥ê°’ í™•ì¸ í›„ í…œí”Œë¦¿ ìš”ì²­
    // ===============================
    function handleTemplateRequest() {
      const extraFields = collectExtraFields();

      if (!extraFields) {
        alert("ì…ë ¥ê°’ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”.");
        return;
      }

      const complaintTypeSelect = document.getElementById('complaintTypeSelect');
      const complaintType = complaintTypeSelect ? complaintTypeSelect.value : "";

      const commonRequiredFields = {
        submitterName: "ì œì¶œì ì„±ëª…",
        submitterPhone: "ì œì¶œì íœ´ëŒ€ì „í™”",
        companyName: "íšŒì‚¬ëª…",
        companyTel: "íšŒì‚¬ ì „í™”ë²ˆí˜¸"
      };

      const extraRequiredFieldsForImkum = {
        startDate: "ì…ì‚¬ì¼",
        endDate: "í‡´ì‚¬ì¼"
      };

      let missingFields = [];

      // ê³µí†µ í•„ìˆ˜í•­ëª© ê²€ì‚¬
      for (const [name, label] of Object.entries(commonRequiredFields)) {
        const input = document.querySelector(`[name="${name}"]`);
        if (!input || input.value.trim() === "") {
          missingFields.push(label);
        }
      }

      // ì„ê¸ˆì²´ë¶ˆì¸ ê²½ìš° ì¶”ê°€ ê²€ì‚¬
      if (complaintType === "ì„ê¸ˆì²´ë¶ˆ") {
        for (const [name, label] of Object.entries(extraRequiredFieldsForImkum)) {
          const input = document.querySelector(`[name="${name}"]`);
          if (!input || input.value.trim() === "") {
            missingFields.push(label);
          }
        }
      }

      if (missingFields.length > 0) {
        alert(`ë‹¤ìŒ í•­ëª©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”:\n- ${missingFields.join("\n- ")}`);
        return;
      }

      // ì •ìƒ â†’ ì„œë²„ë¡œ í…œí”Œë¦¿ ìš”ì²­
      requestTemplateMessage(extraFields);
    }
    // ===============================
    // 5-4. inputì˜ label í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ë³´ì¡° í•¨ìˆ˜)
    // ===============================
    function getLabelText(input) {
      const td = input.closest('td');
      if (!td) return input.name || "ì•Œ ìˆ˜ ì—†ëŠ” í•­ëª©";

      const labelTd = td.previousElementSibling;
      if (labelTd && labelTd.classList.contains('label')) {
        return labelTd.innerText.replace("*", "").trim();
      }
      return input.name || "ì•Œ ìˆ˜ ì—†ëŠ” í•­ëª©";
    }

    // ==============================================================================
    // 6. ì£¼ì†Œ ê²€ìƒ‰ ê¸°ëŠ¥
    //  ==============================================================================
    // ì œì¶œì ì£¼ì†Œ 
    function execDaumPostcode() {
      new daum.Postcode({
        oncomplete: function (data) {
          document.getElementById('postcode').value = data.zonecode;
          document.getElementById('roadAddress').value = data.roadAddress;
          document.getElementById('detailAddress').focus();
        }
      }).open();
    }

    // íšŒì‚¬ ì£¼ì†Œ 
    function execCompanyPostcode() {
      new daum.Postcode({
        oncomplete: function (data) {
          document.getElementById('companyPostcode').value = data.zonecode;
          document.getElementById('companyAddress').value = data.roadAddress;
          document.getElementById('companyDetail').focus();
        }
      }).open();
    }
    // ==============================================================================
    // 7. ë¡œì»¬ì—ì„œ ì§ì ‘ ì§„ì •ì„œ ìƒì„± (AI ì„œë²„ ì—†ì´) --> ì ìš© ì†ë„ê°€ ë” ë¹ ë¦…ë‹ˆë‹¤.
    // ==============================================================================
    function makeComplaint() {
      console.log("=== makeComplaint í•¨ìˆ˜ ì‹œì‘ ===");

      const companyName = document.querySelector('input[name="companyName"]')?.value.trim();
      const userName = document.querySelector('input[name="submitterName"]')?.value.trim();
      const complaintTypeSelect = document.getElementById('complaintTypeSelect');
      const complaintType = complaintTypeSelect ? complaintTypeSelect.value : "";

      const currentStep = document.querySelector('.section.active')?.id || "step2";

      console.log("í˜„ì¬ ìŠ¤í…:", currentStep);

      let workDetailContent = "";
      let claimDetailContent = "";

      if (complaintType === "ì„ê¸ˆì²´ë¶ˆ") {
        workDetailContent = `
ì €ëŠ” ${companyName}ì—ì„œ (ì§ë¬´ëª…)ìœ¼ë¡œ ê·¼ë¬´í•˜ëŠ” ${userName}ì…ë‹ˆë‹¤.  
ë‹´ë‹¹ ì—…ë¬´ì— ì„±ì‹¤íˆ ì¢…ì‚¬í•˜ì˜€ìœ¼ë©°, ì •ìƒì ì¸ ê¸‰ì—¬ ì§€ê¸‰ì„ ê¸°ëŒ€í•˜ë©° ì¼í•´ì™”ìŠµë‹ˆë‹¤.  
(ì˜ˆì‹œ: ë§¤ì¥ íŒë§¤, í™€ì„œë¹™, ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë“± êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±)
    `.trim();

        claimDetailContent = `
ê·¼ë¬´ ê¸°ê°„ ì¤‘ (ì‹œì‘ì¼)ë¶€í„° (ì¢…ë£Œì¼)ê¹Œì§€ ê¸‰ì—¬ê°€ ì •ìƒ ì§€ê¸‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.  
ì²´ë¶ˆëœ ê¸ˆì•¡ì€ ì´ (ê¸ˆì•¡)ì›ì…ë‹ˆë‹¤.  
ìˆ˜ì°¨ë¡€ ì§€ê¸‰ ìš”ì²­ì—ë„ ë¶ˆêµ¬í•˜ê³  ì§€ê¸‰ë˜ì§€ ì•Šì•„ ë¶€ë“ì´í•˜ê²Œ ì§„ì •ì„ ì œê¸°í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  
ì´ì— ì²´ë¶ˆ ê¸ˆì•¡ì˜ ì¡°ì†í•œ ì§€ê¸‰ì„ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.
    `.trim();

      } else if (complaintType === "ë¶€ë‹¹í•´ê³ ") {
        claimDetailContent = `
ì €ëŠ” ${companyName}ì—ì„œ (ì§ë¬´ëª…)ìœ¼ë¡œ ê·¼ë¬´í•˜ë˜ ${userName}ì…ë‹ˆë‹¤.  
(í•´ê³ ì¼ì)ì— (í•´ê³ ë°©ë²•) ë°©ì‹ìœ¼ë¡œ í•´ê³  í†µë³´ë¥¼ ë°›ì•˜ìœ¼ë©°, í•´ê³  ì‚¬ìœ ì— ëŒ€í•œ ì¶©ë¶„í•œ ì„¤ëª…ë„ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.  
ì´ëŠ” ë¶€ë‹¹í•´ê³ ì— í•´ë‹¹í•œë‹¤ê³  íŒë‹¨í•˜ì—¬ êµ¬ì œë¥¼ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.
    `.trim();

      } else if (complaintType === "ì§ì¥ë‚´ê´´ë¡­í˜") {
        claimDetailContent = `
ì €ëŠ” ${companyName}ì— ì¬ì§ ì¤‘ì¸ ${userName}ì…ë‹ˆë‹¤.  
ê·¼ë¬´ ì¤‘ (ê°€í•´ìëª…)ì—ê²Œ ë°˜ë³µì ì¸ ì–¸ì–´í­ë ¥(ì˜ˆ: "(ì–¸ì–´í­ë ¥ ì˜ˆì‹œ)")ê³¼ (ë°°ì œ ì‚¬ë¡€) ë“± ê³ ì˜ì  ì—…ë¬´ ë°°ì œë¥¼ ê²ªì—ˆìŠµë‹ˆë‹¤.  
ì´ë¡œ ì¸í•´ ì •ì‹ ì , ì‹ ì²´ì  ê³ í†µì„ ë°›ê³  ìˆìœ¼ë©°, ì´ì— ëŒ€í•œ ì‚¬ì‹¤ í™•ì¸ ë° ì‹œì • ì¡°ì¹˜ë¥¼ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.
    `.trim();

      } else if (complaintType === "ê·¼ë¡œê³„ì•½ìœ„ë°˜") {
        claimDetailContent = `
ì €ëŠ” ${companyName}ì— ì¬ì§ ì¤‘ì¸ ${userName}ì…ë‹ˆë‹¤.  
(ê³„ì•½ì‘ì„±ì¼)ì— ê·¼ë¡œê³„ì•½ì„œë¥¼ ì‘ì„±í•˜ì˜€ìœ¼ë‚˜, ì‹¤ì œ ê·¼ë¡œ ì¡°ê±´ì€ (ìœ„ë°˜ë‚´ìš©) ë“± ê³„ì•½ ë‚´ìš©ê³¼ ë‹¤ë¥´ê²Œ ìš´ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.  
ì´ëŠ” ê·¼ë¡œê¸°ì¤€ë²• ìœ„ë°˜ì— í•´ë‹¹í•˜ë¯€ë¡œ ì‹œì •ì„ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.
    `.trim();

      } else if (complaintType === "ê³ ìš©ì°¨ë³„") {
        claimDetailContent = `
ì €ëŠ” ${companyName}ì— ì¬ì§ ì¤‘ì¸ ${userName}ì…ë‹ˆë‹¤.  
ê·¼ë¡œê³„ì•½ ì²´ê²°, ìŠ¹ì§„, ì„ê¸ˆ ì§€ê¸‰ ê³¼ì •ì—ì„œ (ì°¨ë³„ì‚¬ìœ )ë¥¼ ì´ìœ ë¡œ ë¶€ë‹¹í•œ ëŒ€ìš°ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.  
ê³µì •í•œ ê·¼ë¡œ ê¸°íšŒì˜ ë³´ì¥ì„ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.
    `.trim();

      } else {
        workDetailContent = "(ì§„ì • ì¢…ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”)";
        claimDetailContent = "(ì§„ì • ì¢…ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”)";
      }

      // â­ ë¯¸ë¦¬ë³´ê¸° ì±„ì›Œë„£ê¸°
      if (currentStep === "step2") {
        if (document.getElementById('workDetailSuggestion')) {
          document.getElementById('workDetailSuggestion').innerHTML = workDetailContent
            ? `<pre>${workDetailContent}</pre>`
            : "";
        }

        if (document.getElementById('claimDetailSuggestion')) {
          document.getElementById('claimDetailSuggestion').innerHTML = claimDetailContent
            ? `<pre>${claimDetailContent}</pre>`
            : "";
        }
      } else if (currentStep === "step3") {
        if (document.getElementById('contentSuggestion')) {
          document.getElementById('contentSuggestion').innerHTML = claimDetailContent
            ? `<pre>${claimDetailContent}</pre>`
            : "";
        }
      }

    }

  </script>

  <!-- Thymeleaf ì„œë²„ê°€ ë Œë”ë§
  <script th:inline="javascript">
    const TEMPLATE_ASSISTANT_ID = /*[[${template_assistant_id}]]*/ "default-template-id";
    const FEEDBACK_ASSISTANT_ID = /*[[${feedback_assistant_id}]]*/ "default-feedback-id";
    const MINI_ASSISTANT_ID = /*[[${mini_assistant_id}]]*/ "default-mini-id";
  </script> -->
</body>

</html>